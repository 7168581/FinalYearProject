<div class="col-md-6 col-md-offset-1">
<div class="center-block text-primary">
	<h3><%= listName %><h3>
</div>
	<div class="scroll-area" data-spy="scroll" data-offset="0">
		<div class="panel-group" id="accordion">
		<% items.forEach(function (item, index) { %>
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">
						<a href="#panel_<%= item.itemId %>" data-toggle="collapse" data-parent="#accordion">
							<%= item.itemName %>
						</a>
						<% if (user.userType == "admin") { %>
							<div class="pull-right">
								<a class="btn btn-success btn-xs" href="#add_to_list_modal" data-toggle="modal" onclick="add_to_list_function('<%= item.itemId %>')">Add to</a>
								<a class="btn btn-info btn-xs" href="/edit-item/<%= item.itemId %>">Edit</a>
								<a class="btn btn-danger btn-xs" href="#delete-modal" data-toggle="modal" onclick="delete_function('<%= item.itemId %>', '<%= item.itemName %>')" id="delete_item">Delete</a>
							</div>
						<% } %>
					</h3>
<!--This is delete_item modal-->
					<div class="modal fade" id="delete-modal" tabindex="-1" role="dialog" aria-labelledby="deleteLabel" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									<h3>Comfirm Delete</h3>
								</div>
								<div class="modal-body">
									<p id="modalP">Are you sure you want to delete this item</p>
								</div>
								<div class="modal-footer">
									<a class="btn" data-dismiss="modal">Cancel</a>
									<a class="btn btn-primary" name="delete-btn" id="delete_confirm_btn">Delete</a>
								</div>
							</div>
						</div>
					</div>
<!--This is add_to_list modal-->
					<div class="modal fade" id="add_to_list_modal" tabindex="-1" role="dialog" aria-labelledby="deleteLabel" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
									<h3>Please select a list you want to add "<%= item.itemName %>" in</h3>
								</div>
								<div class="modal-body">
									<div>
										<% lists.forEach(function (list, index) { %>
											  <a class="list-group-item" onclick="select_list_function('<%= list.listName %>','<%= list.listId %>', '<%= list.itemList %>', '<%= list.rate %>', '<%= list.info %>')">
												<h4 class="list-group-item-heading"><%= list.listName %> <span class="badge pull-right"><%= list.itemList.length %></span></h4>
												<p class="list-group-item-text"><%= list.info %></p>
											  </a>
										<% }) %>
									</div>
								</div>
								<div class="modal-footer">
									<a class="btn" data-dismiss="modal" id="cancel_add_to_list">Cancel</a>
								</div>
							</div>
						</div>
					</div>
					
				</div>
				<div class="panel-collapse collapse" id="panel_<%= item.itemId %>">
					<div class="panel-body">
						<p class="text-muted">
							<strong>Category:</strong> <%= item.category %> | <strong>Keyword:</strong> <%= item.keyword %>
						</p>
						<p class="text-muted">
							<strong>User name:</strong> <a href="#"><%= item.userName %></a> | <strong>User id:</strong> <%= item.userId %>
						</p>
						<p class="text-muted">
							<strong>Rate: <div class="rateit" data-rateit-value="<%= item.rate %>" data-rateit-ispreset="true" data-rateit-readonly="true"></div></strong>
							| <span class="rateit" id="rateit2" data-id="<%= item.itemId %>"></span> 
						</p>
						<p><strong>Description:</strong></p>
						<p><%= item.description %></p>
					</div>
				</div>
			</div>
		<% }) %>
<script>
var item_id;
$(document).ready(function(){
	$(".panel-collapse").first().collapse('show');
});

function delete_function(itemId, itemName){
	item_id = itemId;
	$("#modalP").text("Are you sure you want to delete \"" +itemName + "\"?");
}

$("#delete_confirm_btn").click(function(){
	var url = "/delete-item/" + item_id;
	window.location.href=url;
});

$('#accordion .rateit').bind('rated', function(event, value) {
	var ri = $(this);
	var rate_value = value;
	var rated_itemId = ri.data('id');
	
	var url_1 = "/add-rate";
	$.post(url_1,{rating: rate_value, itemId: rated_itemId},function(data){
			console.log('value saved as' + value);
	});
});

$("#accordion .rateit").bind('over', function (event,value) { $(this).attr('title', value); });

function add_to_list_function(itemId){
	item_id = itemId;
}

function select_list_function(listName, listId, itemList, rate, info){
	var url = "/add-to-list";
	console.log(JSON.stringify(itemList));
	console.log(itemList);
	console.log(item_id);
	$.post(url,{
				listName: listName,
				listId: listId,
				itemList: itemList,
				rate: rate,
				info: info,
				itemId: item_id
				},function(){
			console.log(item_id + " is added into " + listName);
			$("#cancel_add_to_list").click();
	});
}

</script>
		</div>
	</div>
	<div class="col-md-6 col-md-offset-3">
		<ul class="pagination">
		  <li class="disabled"><a href="#">&laquo;</a></li>
		  <li class="active"><a href="#">1</a></li>
		  <li><a href="#">2</a></li>
		  <li><a href="#">3</a></li>
		  <li><a href="#">4</a></li>
		  <li><a href="#">5</a></li>
		  <li><a href="#">&raquo;</a></li>
		</ul>
	</div>
</div>