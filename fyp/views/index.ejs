<%- include header %>

<header>
<h1><%= title %></h1>
</header>

<div class="jumbotron">
<% if (!user) { %>
	<h2>
		Welcome to FYP!
	</h2>
	<p>
		<a class="btn btn-primary" href="/login">Sign in</a>
		<a class="btn btn-success" href="/reg">Sign up Now!!</a>
	</p>
<% } %>
	<form role="form">
		<div class="form-group">
			<div class="input-group col-lg-6 col-md-6 col-md-offset-3">
				<input type="text" class="form-control">
				<span class="input-group-btn">
					<button class="btn btn-default" type="button">Go!</button>
				</span>
			</div>
		</div>
<% if (user) { %>
<% if (user.userType == "admin") { %>
		<div class="form-group">
			<div class="pull-right">
				<a href="/add-item" type="button" class="btn btn-info">Add an item</a>
				<a href="/add-list" type="button" class="btn btn-success"  type="button">Create a List</a>
			</div>
		</div>
<% } %>
<% } %>
	</form>
</div>
<% if (user) { %>
<div class="container">
	<div class="row-fluid">
		<div class="col-md-6 col-md-offset-1">
			<div class="scroll-area" data-spy="scroll" data-offset="0">
				<div class="panel-group" id="accordion">
				<% items.forEach(function (item, index) { %>
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">
								<a href="#panel_<%= item.itemId %>" data-toggle="collapse" data-parent="#accordion">
									<%= item.itemName %>
								</a>
								<% if (user.userType == "admin") { %>
									<div class="pull-right">
										<a class="edit" href="/edit-item/<%= item.itemId %>">Edit</a>
										<a class="delete" href="#delete-modal" data-toggle="modal" onclick="delete_function('<%= item.itemId %>', '<%= item.itemName %>')" id="delete_item">Delete</a>
									</div>
								<% } %>
							</h3>
							<div class="modal fade" id="delete-modal" tabindex="-1" role="dialog" aria-labelledby="deleteLabel" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
											<h3>Comfirm Delete</h3>
										</div>
										<div class="modal-body">
											<p id="modalP">Are you sure you want to delete this item</p>
										</div>
										<div class="modal-footer">
											<a class="btn" data-dismiss="modal">Cancel</a>
											<a class="btn btn-primary" name="delete-btn" id="delete_confirm_btn">Delete</a>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="panel-collapse collapse" id="panel_<%= item.itemId %>">
							<div class="panel-body">
								<p class="text-muted">
									<strong>Category:</strong> <%= item.category %> | <strong>Keyword:</strong> <%= item.keyword %>
								</p>
								<p class="text-muted">
									<strong>User name:</strong> <a href="#"><%= item.userName %></a> | <strong>User id:</strong> <%= item.userId %>
								</p>
								<p class="text-muted">
									<strong>Rate: <div class="rateit"  id="rateit1" data-rateit-value="<%= item.rate %>" data-rateit-ispreset="true" data-rateit-readonly="true"></div></strong>
									| <span class="rateit" id="rateit2" data-id="<%= item.itemId %>"></span> 
								</p>
								<p><strong>Description:</strong></p>
								<p><%= item.description %></p>
							</div>
						</div>
					</div>
				<% }) %>
<script>
var item_id;
$(document).ready(function(){
	$(".panel-collapse").first().collapse('show');
});

function delete_function(itemId, itemName){
	item_id = itemId;
	$("#modalP").text("Are you sure you want to delete \"" +itemName + "\"?");
}

$("#delete_confirm_btn").click(function(){
	var url = "/delete-item/" + item_id;
	window.location.href=url;
});

$('#accordion .rateit').bind('rated', function(event, value) {
	var ri = $(this);
	var rate_value = value;
	var rated_itemId = ri.data('id');
	
	var url_1 = "/add-rate";
	$.post(url_1,{rating: rate_value, itemId: rated_itemId},function(){
			console.log('value saved as' + value);
	});
});

$("#accordion .rateit").bind('over', function (event,value) { $(this).attr('title', value); });
</script>
				</div>
			</div>
			<div class="col-md-6 col-md-offset-3">
				<ul class="pagination">
				  <li class="disabled"><a href="#">&laquo;</a></li>
				  <li class="active"><a href="#">1</a></li>
				  <li><a href="#">2</a></li>
				  <li><a href="#">3</a></li>
				  <li><a href="#">4</a></li>
				  <li><a href="#">5</a></li>
				  <li><a href="#">&raquo;</a></li>
				</ul>
			</div>
		</div>
	<% if (user.userType == "admin") { %>
		<div class="col-md-3 col-md-offset-1">
			<div class="scroll-area" data-spy="scroll" data-target=".scroll-area" data-offset="0">
				<div class="panel-group" id="accordion">
				<% lists.forEach(function (list, index) { %>
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">
								<a href="#panel_<%= list.listId %>" data-toggle="collapse" data-parent="#accordion">
									<%= list.listName %>
								</a>
								<% if (user.userType == "admin") { %>
									<div class="pull-right">
										<a class="view" href="#">View</a>
										<a class="edit" href="/edit-list/<%= list.listId %>">Edit</a>
										<a class="delete" href="#delete_list_modal" data-toggle="modal" onclick="delete_list_function('<%= list.listId %>', '<%= list.listName %>')" id="delete_list">Delete</a>
									</div>
								<% } %>
							</h3>
							<div class="modal fade" id="delete_list_modal" tabindex="-1" role="dialog" aria-labelledby="deleteLabel" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
											<h3>Comfirm Delete</h3>
										</div>
										<div class="modal-body">
											<p id="delete_list_text">Are you sure you want to delete this list</p>
										</div>
										<div class="modal-footer">
											<a class="btn" data-dismiss="modal">Cancel</a>
											<a class="btn btn-primary" name="delete-btn" id="delete_list_confirm_btn">Delete</a>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="panel-collapse collapse" id="panel_<%= list.listId %>">
							<div class="panel-body">
								<p class="text-muted">
									<strong>list ID:</strong> <%= list.listId %>
								</p>
								<p class="text-muted">
									<strong>User name:</strong> <a href="#"><%= list.userName %></a>
								</p>
								<p class="text-muted">
									<strong>User id:</strong> <%= list.userId %>
								</p>
								<p class="text-muted">
									<strong>Rate: <div class="rateit"  id="rateit3" data-rateit-value="<%= list.rate %>" data-rateit-ispreset="true" data-rateit-readonly="true"></div></strong>
								</p>
								<p><strong>Description:</strong></p>
								<p><%= list.info %></p>
							</div>
						</div>
					</div>
				<% }) %>
<script>
var list_id;
$(document).ready(function(){
	$(".panel-collapse").first().collapse('show');
});

function delete_list_function(listId, listName){
	list_id = listId;
	$("#delete_list_text").text("Are you sure you want to delete \"" +listName + "\"?");
}

$("#delete_list_confirm_btn").click(function(){
	var url = "/delete-list/" + list_id;
	window.location.href=url;
});

$('#accordion .rateit').bind('rated', function(event, value) {
	var ri = $(this);
	var rate_value = value;
	var rated_itemId = ri.data('id');
	
	var url_1 = "/add-rate";
/***
	$.post(url_1,{rating: rate_value, itemId: rated_itemId},function(){
			console.log('value saved as' + value);
	});
***/
});

$("#accordion .rateit").bind('over', function (event,value) { $(this).attr('title', value); });
</script>
				</div>
			</div>
			<div class="col-md-6 col-md-offset-3">
				<ul class="pagination">
				  <li class="disabled"><a href="#">&laquo;</a></li>
				  <li><a href="#">&raquo;</a></li>
				</ul>
			</div>
		</div>
	<% } %>
	</div>
</div>
<% } %>

<%- include footer %>