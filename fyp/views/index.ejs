<%- include header %>

<header>
<h1><%= title %></h1>
</header>

<div class="jumbotron">
<% if (!user) { %>
	<h2>
		Welcome to FYP!
	</h2>
	<p>
		<a class="btn btn-primary" href="/login">Sign in</a>
		<a class="btn btn-success" href="/reg">Sign up Now!!</a>
	</p>
<% } %>
	<form role="form">
		<div class="form-group">
			<div class="input-group col-lg-6 col-md-6 col-md-offset-3">
				<input type="text" class="form-control">
				<span class="input-group-btn">
					<button class="btn btn-default" type="button">Go!</button>
				</span>
			</div>
		</div>
<% if (user) { %>
<% if (user.userType == "admin") { %>
		<div class="form-group">
			<div class="pull-right">
				<label class="control-label"><a href="/add-item">Add an item</a></label>
			</div>
		</div>
<% } %>
<% } %>
	</form>
</div>
<% if (user) { %>
<div class="container">
	<div class="row-fluid">
		<div class="col-md-6 col-md-offset-1">
			<div class="scroll-area" data-spy="scroll" data-offset="0">
				<div class="panel-group" id="accordion">
				<% items.forEach(function (item, index) { %>
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title">
								<a href="#panel_<%= item.itemId %>" data-toggle="collapse" data-parent="#accordion">
									<%= item.itemName %>
								</a>
								<% if (user.userType == "admin") { %>
									<div class="pull-right">
										<a class="edit" href="/edit-item/<%= item.itemId %>">Edit</a>
										<a class="delete" href="#delete-modal" data-toggle="modal" onclick="delete_function('<%= item.itemId %>', '<%= item.itemName %>')" id="delete_item">Delete</a>
									</div>
								<% } %>
							</h3>
							<div class="modal fade" id="delete-modal" tabindex="-1" role="dialog" aria-labelledby="deleteLabel" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
											<h3>Comfirm Delete</h3>
										</div>
										<div class="modal-body">
											<p id="modalP">Are you sure you want to delete this item</p>
										</div>
										<div class="modal-footer">
											<a class="btn" data-dismiss="modal">Cancel</a>
											<a class="btn btn-primary" name="delete-btn" id="delete_confirm_btn">Delete</a>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="panel-collapse collapse" id="panel_<%= item.itemId %>">
							<div class="panel-body">
								<p class="text-muted">
									<strong>Category:</strong> <%= item.category %> | <strong>Keyword:</strong> <%= item.keyword %>
								</p>
								<p class="text-muted">
									<strong>User name:</strong> <a href="#"><%= item.userName %></a> | <strong>User id:</strong> <%= item.userId %>
								</p>
								<p class="text-muted">
									<strong>Rate: <div class="rateit"  id="rateit1" data-rateit-value="<%= item.rate %>" data-rateit-ispreset="true" data-rateit-readonly="true"></div></strong>
									| <span class="rateit" id="rateit2" data-id="<%= item.itemId %>"></span> 
								</p>
								<p><strong>Description:</strong></p>
								<p><%= item.description %></p>
							</div>
						</div>
					</div>
				<% }) %>
<script>
var item_id;
$(document).ready(function(){
	$(".panel-collapse").first().collapse('show');
});

function delete_function(itemId, itemName){
	item_id = itemId;
	$("#modalP").text("Are you sure you want to delete \"" +itemName + "\"?");
}

$("#delete_confirm_btn").click(function(){
	var url = "/delete-item/" + item_id;
	window.location.href=url;
});

$('#accordion .rateit').bind('rated', function(event, value) {
	var ri = $(this);
	var rate_value = value;
	var rated_itemId = ri.data('id');
	
	var url_1 = "/add-rate";
	$.post(url_1,{rating: rate_value, itemId: rated_itemId},function(){
			console.log('value saved as' + value);
	});
});

$("#accordion .rateit").bind('over', function (event,value) { $(this).attr('title', value); });
</script>
				</div>
			</div>
			<div class="col-md-6 col-md-offset-3">
				<ul class="pagination">
				  <li class="disabled"><a href="#">&laquo;</a></li>
				  <li class="active"><a href="#">1</a></li>
				  <li><a href="#">2</a></li>
				  <li><a href="#">3</a></li>
				  <li><a href="#">4</a></li>
				  <li><a href="#">5</a></li>
				  <li><a href="#">&raquo;</a></li>
				</ul>
			</div>
		</div>
	<% if (user.userType == "admin") { %>
		<div class="col-md-3 col-md-offset-1">
			<div class="scroll-area" data-spy="scroll" data-target=".scroll-area" data-offset="0">
				<h3 id="section-3">Section 3</h3>
				<p>Integer pulvinar leo id risus pellentesque vestibulum. Sed diam libero, sodales eget sapien vel, porttitor bibendum enim. Donec sed nibh vitae lorem porttitor blandit in nec ante. Pellentesque vitae metus ipsum. Phasellus sed nunc ac sem malesuada condimentum. Etiam in aliquam lectus. Nam vel sapien diam. Donec pharetra id arcu eget blandit. Proin imperdiet mattis augue in porttitor. Quisque tempus enim id lobortis feugiat. Suspendisse tincidunt risus quis dolor fringilla blandit. Ut sed sapien at purus lacinia porttitor. Nullam iaculis, felis a pretium ornare, dolor nisl semper tortor, vel sagittis lacus est consequat eros. Sed id pretium nisl. Curabitur dolor nisl, laoreet vitae aliquam id, tincidunt sit amet mauris.</p>
				<p>Phasellus vitae suscipit justo. Mauris pharetra feugiat ante id lacinia. Etiam faucibus mauris id tempor egestas. Duis luctus turpis at accumsan tincidunt. Phasellus risus risus, volutpat vel tellus ac, tincidunt fringilla massa. Etiam hendrerit dolor eget ante rutrum adipiscing. Cras interdum ipsum mattis, tempus mauris vel, semper ipsum. Duis sed dolor ut enim lobortis pellentesque ultricies ac ligula. Pellentesque convallis elit nisi, id vulputate ipsum ullamcorper ut. Cras ac pulvinar purus, ac viverra est. Suspendisse potenti. Integer pellentesque neque et elementum tempus. Curabitur bibendum in ligula ut rhoncus.</p>
				<p>Quisque pharetra velit id velit iaculis pretium. Nullam a justo sed ligula porta semper eu quis enim. Pellentesque pellentesque, metus at facilisis hendrerit, lectus velit facilisis leo, quis volutpat turpis arcu quis enim. Nulla viverra lorem elementum interdum ultricies. Suspendisse accumsan quam nec ante mollis tempus. Morbi vel accumsan diam, eget convallis tellus. Suspendisse potenti.</p>
			</div>
		</div>
	<% } %>
	</div>
</div>
<% } %>

<%- include footer %>